
var inputText =
@"...>..>..>vv>.>v..>..>>v.v...>.v.>......v.>>..>>v.v.vv.>.>.v..>..vv..>.>>vv..v>v>vv>.>...v.>.>.>v>v>.>>v..v..v..>...>.v...>.>>>...>v.v>>v>v
>vvv>vv..>..v...>>.v>>>v..>v..vv>vv..>>.vv..>...v...>..>.v.v>.>..>..>>.>v...>.v.v>......>v..v.v>......>.v.v..>...>...>.v.>>>v>vv....v.>v.>.
.>.v..>..v.vv>.>>.v.>...>..>>v.vv.v.>>..vv.>vvv>...>.>.......v.>>>.v>vv>>.....>.>vv..vv.vv.v>..>..v.v.vvv>..vv>.v.vvvvv.v.>..vv.>v>v.>..vv.
.vvv...v.....v..vv>>.>.>..>v..>v.v..>>>vv>.>vv>...>v>.>......v>>.v..>.v>...v>...>.vv..>>.>>.v..v....>..>vvv..vv.v.>..v..v.>v.>...v>>.>.>v..
>>>..vv>.>..>>.v.v...>>...v>vv.....v.v..v.vvvvv....>..v>.>.v.>...>>......>.vv.v.v.v>>.>..>>.vv..>.>.v...>>>v..v>..v.vv>>..v..>.....>vvv...>
...vv.>..>....v>>>>.v...>...>.>vv....>.....>v>v.v...>>..........>...>>.....v>v>..>v>..........>.....>v>..>v>v.....v>>>v...v>vv.v>v.v>v..v>v
>..>..>>.v.....>.v.v..v.vv>v.v......>v>v.v>...>>...v>.v.v>.>......>>>>.>v.>>vv>>vv>.>.>>.v..>v.......v>v..v..>vvvvv....>...v>vv.>v..>v.vv..
..v>v>vv.>..>v.v>.>v.vv...>.vv>.v.v>.>vv.v>.>v.v..>>..>v.v>...>>.>.....v..v.>.>v>.>>>..v>v.v..v>.....>>.....>.v.v.v.>vv.>v.>v>v..v>>>>.v.>.
.>vvv>.v>v>vv>>.vv>.vv>v>....>..v.>vv..v>.>.>.v..>.v...>>v>.v.>.>>.>....>..>...>.>...vv>.v...>...v>..vvv...v.......>>v.>v.v>v>v.v>.>.>v..vv
...>>vvv..>v.>v......vv.>vv>vvvv>.>>...>vv>v>>.>vv..vv..v....vv.vvv>.v.v>v.>>..>v>.v>>....>..vvv......v>.>vv>..>>.v>..>.v>.v.......v.v..>.>
...v>.v..v>>v.v.vv>.vvv.>vvvvv..>.....v.......>.v.v.vvv.v.v...vv..v>>v>>>>..>...v>>>>.vv.>>v.>........vv.vv.vv>>vv.>..vvv...>.>......v.>..v
v.v>vv.>vv>vvv...vv.vv...>...>>...vv.>.vv.v>>..>..>......vv.....>..v..v.>v>.>>vv...v..>.v.v.....vvv.v>.v.vv......v....v....v.>>>.v..>v>....
..v.>..>>>v.....>vv..>>.>>...v.v>v....>..v.v>..v...v..vvv.v>....>>v>.>.>...>v..>..>v.>>>v.>>.>vv>.>v>.>.>>.v.>>..>..vv.v>v....>>>vv..v>....
.>...v>.vv>>..v.v..v.v.vv..v>.>>v..vv>.....v>....>...v......v>.>v>.>..>..>>v.>>>.vv...>>.v>.>>.>.>v>>......v.v...>v..v.>>>v>v..>.v.vvv>>.v.
...v....vv..v.>>.>>.>..>.vv.>.>>>..>..vv..v>.>>v.>..v....vv>....v....v...v.v..vvv.v.v>.vv>.v>..vv.>v.vv>vv....>...>........>...>.>.....vvv>
.v.>........v..>.vv>>vv......v..vv..>>>>>v...v>>v>..vv.>..>v>..vv.vv.>v.v.>.>...v..>>>..vv>.v.v>...>>..>.v>v>>v.>....vv..vv.v.....>v>.>.>.>
.>.v..>v....v>..v>v....v>vv....v>>..vv.>...>.>..>..v.v.>v...vv..v.>....v>>.>vvvvvv..v.>..v.v>..v>>...>.v.>>>..vv.v.>....v>.>v>>.vv.>.v..v..
>>..vvv...v..v.v...>.v.>..>...>.>v>.v.v>v..v.v>..vv>>>..vv..>v.v.>..vv....>v.>>.v...v>v.v>...>v>v......>.>>.>.v.>.>v>>vvv.>v..>...>>v>v..>.
>..v>.v.>v>vvv.v...v>v>..v>.>...v.>..v....>..>.....>..>v....v..vv.v>>v>>...vv...>vv>>.>.>.>.v.....>..v>>.v.>v>v>>..>v>....>.>>.v>.>v>.v.vv.
..vv.>....v..vv>...v>>>v>v>.>.v.>>.vv.v.vv...>.>...>.v>..>v.>v.>>v.v>.>v..v.>>..>.v.>>vvv...v..vv.vv.vvv>...>.v.>>v..vv.>..v..v>..>v>>.....
..v...v>...>>.>.v.v..>..v..>..>>>>vv.v.......v>..v....v.v..v>v.>.....v..vv>.vv..v>>v.>>>..>v.>..vv>.>.v>...v>.v.v>.>..>.>..>..>..v...v>.v..
vv.>v.>.vv>.v.v.vv..>v.v>>>>v..v.v>v>>>>>..>vvv..>.v....>>v....>.>..v>.>...v>vv..v>.>v.v..v...v.....>>>>v.vv..v.v..>v>..v>>>..>>vvv.v>.>vv.
v.>..>>.v>v..>v..vv.v>>vv>..>...>vv...>>..>>v>>..v.v..vv.>....v.>.......>v..v...>v.v>>....vvv..>....>>v>..v.>.v...v..>.v>...>v>v>.>v>.>v..v
v>...v>..>...>>...v....vv>>>.....>.>vv.v..>.v.v.v...v>v.v.v.....vv.>>.vvvv..v...>...vv>...>v.v>.>v.>>>>>v>.>>>>......>.>>.>>v.>.>>>>vv.>..>
>.>..v..v>.....>...v..>.>>.>v>...>v.>>..>..v.>>.v>>.v>>>..v.v.....v...v...v..v...>.v>.vvv...>>..v>>.>..>.v...>..v>v..>...vv>v.>..vv>>..>.v.
.v.vv...v>..>>.......vv>..v.v>v.>..v....v.>v.>>.v..v.v..vv.v.v.>>...v>vvv>>..>v>....v...v>>vv...v>...v>.v..vv>..>..>.......>>..>v>>vv..v.v>
..vv>..v...v.>>vv...>.v.....v>>.........v>v>.>...v>>.>.>v>.>.>..>>>.v.v..vv...>..>>v.v..>..>.>>>.v>..vv.>>v.>>v>..v.v....v...>..v..>>...vv.
.v...v.>v......>.>>v>...v.....vv..v.>.>>.>v..>...vvv.v>....>v>>.....>v...vv>v..>>.>v.>>.v..v..>v>.....>..vvv.vv.>.vv....>....>.>>.....v>...
..>.v......v.>....>vv..v>>v.>.v...>>...>.....v.vv>>.vvvvv.v...v..v.vv>.....vv.vvv...vv>....>.>v...>>>v>..v.v>.v>..v.>..>.>>..v..>..>.>.>v>>
v...vv..v..v>>.vv.>>.v..>v>....vv>v>.>.v>v.>..v.>....v>>.>...vv>.>.>.v.vvv...v....vv>>v...>.vv.v..v.v.vv.v..v.v...>>>.>.>>>>>..v>v>.v.>v.>.
v>.v.v>v..v>vvv....>vv>vv..v..>vv.>v>v..>..vv>>v..v..>.v...v.>>...>.......v>.v>...>v.vv.>...>.v.>>.>>.>>.v>.v....>..>v...>..>.>>.v>v>..>.v.
v>v.>.>>..>.v>v.vvv.>>>>>>.>....v.>>>.>v.v...>vv.>>>v..v>.>>v>vvv...v>v.....v.v>.v.>.>.vv.>v.......v..>v>>.v.>.>.v..vv>.>>>..>v>vvv.v>...v.
....v..v>...v>.>v.vv..v>>v.vv>..>.........v..>>.>.v....vv..v.>v..vvv.v....>..>.vvv.v>..v.>....v>.v.>v>v.v.>..v..>vv.....>>>vv.v.>v>>v>>>..>
...>.vv>..vv.>.v.>>v>>v...>..>.>>>>.>vv.>..>..v.>.>vv.v>..v>vvv>.vv....v.v.>.>.>..vv....v.vvv.vv>v>>>.......>v.>.....>..>.v>.>.>.v.>v.>>..v
..vv.>...>>vvv>..v..>..v..>vv.>.vvv>.v.>...vv>.....>.>vv.vv>.>..>vv.vv.vv>.vv...vv.vv.vv..>.>.>.>....>.>v.vv>.v.>......v>v>.vv.>......v.>..
v>vvv>>>.v..>v.v>v.v>>.v>.>>v>.>.>....vv>v.v>......v>..>..>>v>..>>...>v.......>..v.>.>vv.>>>...>>...v.v....>>..>.>.vv..>>vvv...>vv>>..>...>
v.vv.v.>.v..v...>..>.v...>v.>.>..v.>.>v..>>>.>...>vv.>>..v.>...>v>..>v....v..>..>>v>>..v..v...v.v.....>v>...v.>vvvv.>.>.>.v..>v>>v>>>v.>.>>
..vvv...v.v.>v...v>>....>v>>.>..>.>v>v...v.v.......v>vv...vvvv>..>.v...>.v>..vv>>.....>>>v.>..v>.>>.vv..v.v>.>.......>>.v..v..v>v>>>>.....v
.v>vv.>.>>.>v..>v....v>..>>>vv..>..v.>vv>>.v>v.......>>..v.>>>vv..v..vvvvvv.>>v..v.vv>.vv....vv..v.v.>v>..v.>>>>..v.v...>>v>......v.>.>....
v.>.vv>..>v.......>>>.>.....>>.>>.>.v>>...>v.v...v.>.>vv>.vv>.>v.v.>.>>v.>vv.>>vv...>v.v....v.v.>>.>>>v>.>.>>v..v...>vv>...>>v.....>>v>v>vv
>.v...v..v>v..>v..v....v>...v.>.v..>v.v>>....v>...>vv...v>.vv...>>.v.>..v.v>>.>v.v>.>.v..>.v.....>v.v>v.>v>v.>v>.>v...>.>>..>>v...v.v>.v.v.
.>vv..v..>.v.>>.>..>...v..>>.vv.v>.v.>v>>v....v.v.>...>....>>>v..>>>..v...vv...v>>v.v..v..>>..>v.>>...vvvv..>v.v.v.v.>v>>.v>>.....vvv>..>.>
>.>.>v>>.v>v...>.v...>...v..>>....>v>.vvv>..>...>......vv..>.>.v.v..>>..>.>.vv.v>>vv.v>.>...>>.v.>...v....>>v...........>>.>.v>.>>v.>v.vvv>
...vv.>....v.vvv>v.....>.vvv>.>.v..v.v.v...v.>>...>vv.>.v.>.>..vv.vv>v>>....v.vv.vv>v...v>v>.>>v..>..>vv..>...>>v....>>...vvv>>>>>.v.....>.
>....vv..v..v>.....vv.v.>..v>.>v.>v.v>.v..>...>>.....>..>>..>.vv>..v>.v...v.v.>>.>v>v..v..vv>vvvv>>vvv....>..>...>..v...v>>.v.>.>..>v>.v.v.
...>.v>>..vv..>>>..vv.v>v.v..vv>......v....>.>..v.>...v.v>.v>v>v..>>v..v>v>v...v>.vvv.>v..v..vv>.......>.v>v>>vv>>..>..vv>>.v..vv>>...vv>>.
>...v...v.v.v>>v..>>..vvv.v...>..>v...>v>>>>>..>....vvvv....vv.v.>.v>>.....v..>>.v...v.v.>...v.>v>>vv..v>v....>>vv...>v..>>>.v.v>..v....>.v
.>.v>vv.v>vv....v>..v.v>v.v>v..v>v.vv>>..v>..vv.....vv.v..>v.>.vvv..v..>.v>..v>.>..>.v.v>>..>.v>v>>>v.v...v.v>.v......v.....vv....>.....>>.
>...>>>...>v>v..v>v....>...vv>v..>..>..v>.>>v.vv.>>>.>....v>.>vv>.>.>..v....>>....>>v>.v..>>.>..v>>.vv..v>....v.>.v.>v...>vvv..v>>v....v..>
>.>>.vvv>v>>.v..vv>...>.v.v>v.v....v>>.v..>.>...vvvvv..>v>.v>.>>.>.v..>...>...>.>.>>.>v.v..vvv...>.>>v....>.v....vvvvv.>>..v>.>vvv.v>v.>>>v
v>..vv......>v...vv.>.....>.v>..>..>vvv....v..v.>>v>....>.>.>vvvvv.>...v..v.vv.>........>>v...........v>.>>vv>>>>.......>......>vv..v.....>
.>........v.>>...v........>>>.>.v..>.v..>.>..>>.>.....v>>.>.v>.>v.vv>>>>v>v...vv.v>.v....vvvvv.>>.>>>..>..v>>>.>v.>>..v....>..>>>...vv...>.
.v..>.v..>..v.v.>>.vv.......>..v>...>v...v..>..>v.....v.....v.v>v.v..>.v..v>>.v>>>..v>..>...>>>>..vvv....v>v..>vv..>>.>vv.vvv>>>....v>.vv.>
.>>>v.vvv..>v....vvv.>>>...v...>...vv>>>v>>>vv.v.v>v..v>v>>..>...vv.>>.vv.......vv.v>>.>v>.v.>v..>.>.v.....v>.>>.>...v...>>>>.>v>.vv.>....>
>>.>>.v..v.>>.v...vv...vvv.>.>...v>..>..vv.vv...v>..>v>.v>>..>.vv.>..>..v..vv.>>>v..>>.......>v.>>vvv....v>.v>.v..vvv>.>>>.v>>...>..v>>.v.>
v>>.>vv....>vv.>v..>v.v....>v>...v>vv..v..>...>v>.>v>....v......>vv..v...>v....>>.>>.v..v.vv....v.>v>.>v>.>v.>.>>>>..v....>.>.....>v..>.>..
>>v.v.>>...vvv.v..>vv.v>>v..v.>>v.v.>.>>...>vv.>.v.....vv.>>...>...>v..>>>v.>.v...>..v.v>v>.....v..>..v..>v.v.>v.>>.v.>v.v.v>>.v......v.vvv
>..v>.vvv.>>...>..>v....>v>........v..v...>...vv....vv..>>...v.....>v.>.>v...v..v>vv>>.v....>vv..v>v..>.....v>.>v.v.vv.v>......>v....>>>v>.
>..>>v..>>>>......vv>v.>..>.>.>>...>...vv..v.>>.>.>v.v.v..>..>v>....>.>..>vv.>>.>.>.v...vv....v>..>.....>v>....>.>.v....vv..>..v>>.vv...v>.
v.vv..v>>vv>.v.>.>..>..v..>..>>>v.>..vv>vv>.>>v>v>>v>v.>..>vv....>....v.v.v>>.vv.>.>.>>..>>.vv>.vv>..v>vv.v...>v.>v>v.v....>v...vvv.>.v...>
v>v.>.vv...>v>.>>vv>v...>..v...v.>v...>v..>>..vv..v>>>.>v.v>....>>>..vvv.v>vvv>>.v.>>.v....>.v>...>v...v>.>.vv>.>v..>v.v.v>.v.>......>>...v
v>.v.v...v.>..>>>...>>vvvv....v.....>..>.>.>....>.......>v>..>..>..v>...>v>v.vv.v>>.v>..>v>.v..v.>>..>.>>>v...>>>>.v..>>v..v.>v.v....>>.v..
.v>v.>...v..>..>.>...>..v.v..>.>v.>>v..vv..v..>v..v..>>...v..>..v..vvvv.>.v>vv>vv.>..v..>.v..v.>.....v..v>.v.v..>...v..v.vv..v>>>..>.>vv>..
.v..v.>....>v.v.>...v...>.v...>...v..v..>.>vv.>v.>>>...vv..>>.>...>.v>>v.>>>>..v...>...>.......>.>....vv.v.....v.>>v.....vv>...>...v..v>>.>
....>.v.>v...>..>..v.......v..v.vvv>.>v.>..v>v.>>>vvvvv....>vv...>vv.>.>.vv....v..>>>>>vv..>v>>v>>>>.v..v...v>>.>v>vv..v>v.>vv.>..>>>.v..vv
.>..v.v...v.>.>.vv.v>>.v>..v...>>.v.>>v>..v>..>...>vvv>>v.>.v>>>v..>.v>...>>>...>.v..>>..v.....>v....v>.>>.v>v...>>.>>>...>vv.vv...>>>>.v.v
...vv.>.vvv..v.>>.......>v..v>...v>.v>.>..>vvv..vv>v.v..v>.....>.v.>>....vv>.>...>.v...>>.v.v>.>v.vv.v>v>>..vvv>>..>v....>>v..>.>..vvv>.>.>
..>.>>...>.....v>v>...>.>v.>..vv>..vv...v..>...>...v>>...>v...>..>v..v.>v....v.>v>.>.vv.....>v>vv......v..>.>.vvv..v..v....>...v>v.vvv...>.
>..v...>v.>......>v.v>...>>...>>v>..>.>v>.>v..v>>>>>......>..>>....v.v..>.>>v.>v...>vvvv.>>v.>.v>>.vv>>...v.>.>.v>v.v..>..v>.....>.>.>>...v
.>>.v...>....vvv.v..v>...v..v....v>v.>>>..>.>.....>..v.v...>v>..>v>.v.>>vvv...>.vvv.>v....v...v>...vv..v..v>..>.vvvvvv>>>>.>>.v..v..>..vv>>
...vv.v....v>>v..v.>.vvv>>v...>...>>.v>.v.v>v.>vv>>vv.v>>.>.....>>v.vv...v.vv...v.v.>.>v.....>.vv..>v....vv>.>.v>>.v.>.vv.>...vv.v..v..v.>>
>v..vv>.v>>v>.v....>.v..v....v..>..>>v..>.....v......>>.vv>>v>v...>.v..vv.v>v.v>...v..>>vv.>.v>>vv.vvv...>..v>.>v>.>..>v..>>>.......v..v.>.
..>...vv>.>>>vv......>.vv>v..>.>...>...>.>>.>....v>...>.>vvv..v.v.>v...v>..>>>v>v...v...>v.>.v..>..>...>.v>v>>.v....v>.>v>...v.vv>......v.v
>..v......vv.>>>.v.>.v>.v..>>v.v>>vvv.vvv>.v.>>.v.v.>.v.>>.>.>>.v.>vvvv>v.....>>..v>.........vv>vvv>v.v.>v>v.>v>vv>.......>...v>.v.v.>>.>vv
....v..vv...v...>vvv...v...>>.v>v>v...>.>.>....>v>>v.>v>vv>.>..v>.v....>>.v.vv.vvv.v...>.v.>v.vv.v>>..>.>.v.....>.>..vvvv.....v>>.>v.>...vv
.>vv...>....>...v.vv..v.v>>.>.>>vvv.v.vv.v...v...vv.>.v...v.>v>>>..v.v>>>v..v..v..>.v..>>.............vv.>..v.>>..vv...>....>v>>>....>>v..v
>v.>>..>>v>..v.>v...v>.>>>>>..>vv..>>.>v.>>v.v..>v.vv.v....v..v...>vvvv.>vv>..v>v.v...>.v>vv..v...>>v..vv>vv..>>v.v.vvv>.v..>>..v>vvv.>v>v.
.>>v>vv..>v...>vv>..v.v....v.>>.v..v..>.v...>>>..>...>v>>.>.>..vv>.....>>.v>....v..>>>..v.v>..v>...>...v.>.v....v.v.vv>v.vvvv>>v.>...>>.v.>
.v.v>.>vv.......>>.>.>....>v.>>.vv.>.>vv.vv..>v>.......v>...v..>vv..>>.>.>v>v.vv..v>..v.vv....v.v.>....>>v>>vvv.>.v>.v..>v>>v.v.vvv>v..>v>.
.>v.....v..vv>>.v...>...>...>v>.......v>..vv.v>.>.>v.vv.......v>.>..>>>.........v.v.>.v..>>>.v..vv>.>>v>>>vv...>.>v>.>.>.v..>>>.vv.v..v.>..
.>vv>vv>.....>..>...vv>..>.>.v.>v.>..>.>..v>v....v...>.........v.>......v>.>..>....v.>...v.>>.v>v>>.>.v>.v.v.v>>v>>..v>vv.v..>.v.vv>v...>..
>v>.v.v..v..v..>..>vv.v>vv..v.>.>v......>.>.>...>v.>...>.v>..>>...>.v.>>.vv..vv>......>..v..>.>>vvv...v>>...vv....v....>>>>>v.v.v>>.>..>...
>vv..v..>.>v.v......>>..v>>.>v>>v.v>..v>.>...>v.vv.v>v.vv>.v>>..>>>.v....vvv..v.>>.>>...>>.>v>v.>>....>v.v..>v.>v>....>.>v.>...v.>>.>..vv..
v.>vv....>vv..>.v...v>.>>.v.....>.vv..v>v.>..>vv.>.v.......v.v.vv....v.>..vvv.>.vvv>..>.v.......>.v..>v>>>>.v.v>....v..>.....v.>v...>.v>v>v
.....>>v>.v.>v.v.>v..>>.....v>.v....vv.>..>...>v>>v...v>vv>..>....>...v>..>v...v>v.>...>..>>....v.>v>.......v.>..v.....>>.>v.v......vvvv>v.
.....v>vv.v...>..v..>...v.>....>..>>.v..>..vvv.v.vv>..>v..>.v...v..v>vv.v..>>v.vv.>.>...>v>>.>v..>.>....>vv...>>......>v..v>v..>>>.v>.>.>v.
..>v.>>v.>vv>.>..........v>.vvvv...>v.>.v>.v..v>..>>.v.>..v>.v>v.v.v>...v.>.vv>......>v...vvvv>vv.>>>.vv>v....v>>>vvv>v>.v.v>>.v>.v........
...v>>..>v....v.v..v>vv.>>....>...>>>...>.>..v..v.>.v.v>>.>vv..>>.....>.>.vv.v.v>v.>>........>v.v..>>v.vv.>v>v.>.>.vvv.....>.>.vv>>.v.....>
>.v.vv.>>>.v..v>v.v>.>>.v.v..>>>.v..v..>.v.>vv..>>.v>...>..vvv>..>v>>>.v>>.v...>.>vv>v.>>vv..>....>....v...vvv>..>v..v.v>>>v>...v>>.v>v.>>v
....v..v...v..v.v.>>>.v.v..v.v>>v..v..v>.v..>v.v>>.v.vv..v>>..>.>.>>.v>vv.>>>>...>....vv.>......>.v>>.>v.>>.......v..>v>>>.vv.v>vvv.v>>.v.>
.v..>..>v>v.v...v..>>..>vv.....v>>.>.vvv.vv..>>>vv>vv.>v>.>........>..>v.v>.>.>.>v...v.>..>>.v>>...vv>.vv>.>.v.>..v>.>v.vv>>vv.v>v.v..>vvv>
>...v..>.v>v>.>vv>>v.v...>v...v>>.>.v>.>.>v>>..v.>...vv.v.vv..vv>.v..v.v.>>.v.>>vvv..>v.....v..vvv.>v>v...>..>v..vv.>v>vv.v>.v>.v.v.>.>..>.
>v.>>v>>..>.v>.....>v.>...vv.>>..v>>...>vv>v..v..v..v..v...>.....vvv.>..>v...>v.....v>.....v>>.>>>vv>.>...v.>.v>v>.v>v>...v.....v>vv.>..v..
>..v>v>..>v.>.>>..>...v.>>v.>..vv...>vv>vv>.>v..v..v>..>>.v>>..v>.>..>>>>>v>...v>>v..>.>.v>......>>.>vv>>.vv..>>...>>>>>..vvvv>>>..>>...vv>
.v.v>..>v..>.>v....>vv>>>>v.>v>..>v....v...v.>..>v.......>>>v..>vv.v>..>..v>.vvvv.v.vvv.....vvv>v...v.>....>.>>v.>>...>..>>..>>vv...v>>>..v
..>>>..>...v.v...v.v...>v..vv.>vv....>>>vv>.vvv>>.>v.v.v.>v>.>>.>v..v>.>.v>.>..>v>>vv..v>..>>.>>>>...v.>>.v.>.>v..v.vvv..>v...>.>v...vvv...
>vv.v>.v.v..v.v.>.....v.>>.....>>vv.>vv..>v>.v.....>v>>>...>...v...v.>...>v.v.>..>vv.....>....>>.>>.>v..>>>>v...>vv.v>..v>v..>v.v..v>>>.>>.
v>>>.v.v>v>v.>.>.>>....v..>>v>...>.v>>.......>v>.>...>v>..>>..vv.vv...v..>..vv>...>....vv>>..>v>.>.......>..v>v>v....>.>>..>.v.v>>.v>.>vv.v
v>>v>.vvv>>>..>v.v..v..>.......vv.>.v.....>.>>vv>..v.v>...v>v...vv>.>v>>.>.>v..>...v>vv.>>v.vvv.vv>..>v>....>v>vv...>...v.>v.>..>.>.>.v>..v
.>>>..v>v...>.v...>....v.v>v>..>.v..v.vvv>>..>>>v>>>..>v.v.>>v..>.>.v.>v..v...vv>v....v>....>>.>..>v..>>v>.v..>.>......v.v..v>.v...>.v.>v>v
v.v....v>vvv.vv.>v>......>.>...v.>.v....v>.vvvv.>>.>v.>vv..v.>vvv>.v..v>>.v.>vvv...>.>>>>>v>.>v.v..v>.v>vv..>.>.v.>....v.v>>.vv...>>>v...>.
>.>v>v.v.>.v.>.>>.......v...v..v.>>>v.>vvv..>...>>.v......v.vv>..>>.vv.v>.vv..vv.v.v>>...>.>.vv.>..v.>vv..v........vvv>v>v.vv....v..>.>v...
.>v....>v.>>>.v..>...v>...>.>v...>>v>v>....v>.v.v..vvvvv.v>>....>vv.v..v.>>.v>>>>>>.>vv..v>.....v.v..v.>v..v.....vv...>v>.v>.v...v..v.v.>vv
.v.v..>v.v...>>....>>..v..>>v.>>vv>>>......>v...v>>>.>..vv>..>.vvvv.v..>.>v....>..vv....v>>>.......v..>.v..>v..v>.vv.....>.>>>>>...v.vv.>.>
v.>.vv>>.>v...>..v>>.v...>.>>..>>..vvvv.v>>vv>v......vv.>>vv.....>..>..v...>>..v>.>v.vv>v>v..>>>>...v>v...>>>>>v>>.v.v>.>v.>>vvv.>......>>>
...vvvvv.vvvv>...vv...>..>.>>...>.>.v>v.>.vv>vv.>>vv.>vvv...>.v.>>>v.....v...v.v>v......v..v..v.>>>vv...>.v>.v.>v.>...>v>.v>.v.v>.>v>vv...>
.>..v.....v.v.>...v>v.v>v...v..vv>vvv>>>.>.v...>vvv.>vv.v....v...v...vv.....>..v>..>v.>v.v.>v.....>v>v....v.>.v>.>.v>>.v..v...v>>...v>.>.>v
.vv>v....vv.v.v>.>v..v.v>>.>.vv.>..v.>>.>....>...>vv...>.....>..>vv..v.....>v...v>....v..v...vv.......v.v>v>v>>..>v...v>.v.>..>v.>>..>vv.v.
v..>..v.>....vv.vv..v.>.>v>..v.........v.>.>.>.>>>>>v>>.......>>>.....v.>......>vv>vvv..v>.>...>>.v...>>.>.>....>.vvvv.....vv..vvv..vv.>>.>
.>>..v...>..v.>..vv.>>...>.v..vv.>..v..>.vv.>v..>>...>.>>>.v>>v..>>....>>v....>.>.v..>>.v.vv>..v.>>.v..>.>v.>.vv..vvv..v.v>..v..>v.vv.v>v>.
..>>.v...vv>>.>v...v>v..>.>.v>.v>vv>......>..>.v..v>vvv>.v>.>v.>.>v..v.v>v..>>.>.>v>v..v.v.v>.>...>..v...>>..v>.>..v......>vv.v.v>v.>.....>
.v.>>vv>>..>.v..vv..>......vv>v.>v....v>>..v..vvv>v.>v.v.v.>>.v.>>..v...vv..>>.v..>v>..>vvv>vv>vvvv>...>v.....vvv>v>.v..vv.>>..vv.vvvv..>.v
v>>....vv>.v.v.>.>.v.v.>v.>>.v>v>>.>>..>.>>.>vv...>..v....v...v.v..vv.....>vv>...v.v.......>.>.v>.>v..>..v...>>.>>>>>.v.>...>>.>.>v.v...>>v
..v......>.....>.>v..>vvv..>v..v.>.....v....>.>.>v.v>.>vv>.>..v>>>>.>>v.v.v.>.vv>v..>v.>v..vv>.v>v...v..v.vv>..>..vv.>v...v>.....>.v......>
v>>....v...v.vvv.v..>.v>v...v>......>.v......>..v.>..>>v........>.v..v.vv.vvv....>v>vvvv....>.vv.>>.v>.v...>.v.v.vv..v..vv>..v.vv.v>...>.>>
v.v..vv>v>.>>..>>..>v>v..v...>.v.>.>>...>.v..>.>>.>>.v.v...v.>v.>vv.>>v.>.>>>.v>..v.vvv.>...v>.....>v.>>.v>>..vv.v>.v..v.>.>.>.>.>v...vv>..
>..vvvv.>.vv.v>.v>vv.....vv.vv>.>..>.vv.>.>..v.....>>>>.>.>>>v.vv>>vv..v.>>>>>.>...v.v..v>>>.v.>>.......vvv>v>.>..vv..v.vv>>v....>v........
...>>.>.v..>v..>>..v.v>>..v.>>...>.v.>>..v.v.vvvvv>.v>.v.v>.>....>v...>.>v..vvv..vv>v.v.....>>.v>v....>.....v.v.>v..v.>....>v>..v..vv...>>v
.vv.v.>vv..>..>......vv..v>....>v.v....vv.>.v..vv>.>v...>>.....v>....>>.....v>v.>.v.>.v.>>..>>.........>>>>.v..>v>>.>..v....>......v.>>>.v.
>vv.v>..v.>v.v.v>.v..>.v..v>..>v.>vvv..v.>.>.vv.>v.>...v.....>....v..v..>.>...v..v.v>..>>>vvv......v.>.v...>vvv....>v.v.v.v>>v>>v>>..>v>>.v
>>.....>.>..>>..>>vv.>...>v.v>>v>>.>v.>.v>>v.v>.vvv>.....>>.>..>..>v.vv..v.v..v.>>v>....v.>>.vv.>v>>v>v>v>.>v.v>.v.>..>.v...vv.>v..>>..>>>v
.>>>..vv......vv...v.v.v.>v>.>.>>>..v...>>.v.>.vv..v..>>..v.v...>>v>vv>>>v>....>>v.v>.v>>..v.>.>vv>>v.>...>>.v.>...v...>>.>>v>>v..v.v.>vv..
v>>..v.v.>v.v....v.v.>.>v..>.>.>.v.....v>vv..>vvv.>......>..>...>>v>....>vvvv.>.v.>v>..>>.v..v..>>>..v>>>..v...>>v>.v..>.v...v...v.v>.v.>v.
...>v.v...vvvv......>.v..>>>.>........>..v..>v>.v...vv>vv>>..vv..>>.v....v>>>..v..>..>>vv..v.>v>.>.>>>vv..v...v.vv....v..>v..v>.>.>.v.>..v>
>.v.v>>.>v..v>v..v....v.>>.>vv>v....>.vv......vv>...v.v.vv..v>....>v.>.v.vv..v.v.>v>>v>>>..>>.>.>..>vv..>v..>.vv...v>>..v>v..>.>>..v..>>.>.
.>........>.>>>>.v....>v.>v>...>.v.vv>>..v.>...v.v.>vv.>v.v>..>.>vvvvv...v>.v.>..>....>.vv....>....>..>>vv..vv>.>.v.v>.>..v.v.>...>.>v>>.v.
v..>vv>vvv..vvv......v..v..v..>v.v>>.v.>v.vv.>...v>v>..v>>>..v...vvv>v.....>..vv.v.v...v.>v>....v.>>..v>..v...v.....v>...vv.>v..>.>>.>v>v>>
>v>..>....>..v>>v>>>..>v.vv.v...v.>>.>.v.vv..>vvvv....v....>.v..>v>v>...v.v.v..v>..>.>v.v..>..v.v..v..v.v>...>...v>v..v.>vvv.v>vv..>.......
............v..>.v>v>v>.v>vv>.v>.>v.vvv.v>..>v>..vvv.>>..>>vv...>.>.>.v>v>v.v>.vv.vvv>vv...>vv.>.>.v.....>.>.....>v.......>>>v.v>.v>v.vv.>.
v>.v>>..>....>.vv>>.>.>..v...v.>v.>v..>>...>.v.>v>v..>vvv.>vv.v>>..>>..>>....v....v>.vv....v>>v.v..>......v>v>>.v..>.>vv.>..vv>>v.>>.....>.
..v...v.>v..>.v.>>..>..>v...>.v..>.>..>..>..>v..v.>.>..vv.>vv..>.>>..v.v>..v...>v>.>....>>.>v.>v.v....>..>.v.v>..v>>>.v.v>.v..>>>>.v>v.>>vv
..>>v>>vv>v......>>...>.>>>>>>..>>..>>>.>>>.....>v>>.>>..v>..>>..>>....>>.>.>>.>..vv>.>.v......v>....v>v.>vv...vv>..v.>vv..>v.>..vv..>...v>
.v>vvv.v..>.v>.v.v>..v>...>.........>vv...>.v>.>v.>v.>.....vvv...>vv>.v>>>.v.>....>..vv>vv>...v>..>v>....>....>vvv>>v>vv.>v.>..v.vvv>v>>>.v
..>v....vv.v...>..v...vvv...>>........v...>.>>.>>...v..>.>>..>v.>v.v>..>>.v.v..v>..>.>...v.>v.>v.vv>>v>>>....>>vv.>v.>>>>.v......>>vv.v....
v.>vvv..v..>...v.>v>.>>.v>v.vv>...>.......>...>>..vv..>.>>vv>.v>..vv.....vv.....>v>..>v...v..>..v.>..v......v>..>..>>...>..v.>.v.>.v.vv.>vv
.v.>....v.v>.>.v.>>>v...>>...>>...>>v>>v>.>.>v.>>.>>.>v.>vv>....>.v.>>.v...>v>>v.>v..vv>v...vv.v>.>v...v.v.vvv.>v>.vv>..>v...>>v...>..>...>
......v.vvv.....v...>.....v..v.>>v.>.vv..>..v>v.v.v>v..v..v.>v>>vv>..v.>v.>.....v.>.>v.....>>.v>>...vvv>>.vv.v.>vv..vv..v>v>.>.>>>>v.vv...v";

//var inputText =
//@"v...>>.vv>
//.vv>>.vv..
//>>.>v>...v
//>>v>>.>.v.
//v>v.vv.v..
//>.>>..v...
//.vv..>.>v.
//v.v..>>v.v
//....v..v.>";

//var inputText =
//@"...>...
//.......
//......>
//v.....>
//......>
//.......
//..vvv..";

var state = inputText;
var prevState = "";
int i = 0;
while (state != prevState)
{
    i++;
    prevState = state;
    state = simulateStep(state);

    if (i % 100 == 0)
    {
        Console.WriteLine($"{i}:");
        Console.WriteLine(state);
        Console.WriteLine("");
    }
}
Console.WriteLine(i);


// See https://aka.ms/new-console-template for more information
Console.WriteLine("Hello, World!");

string simulateStep(string state)
{
    var stateLines = state.Split("\n");
    var ret = simulateRight(stateLines).ToList();
    ret = simulateDown(ret).ToList();
    return string.Join("\n", ret);
}

IEnumerable<string> simulateRight(string[] stateLines)
{
    var rowCount = stateLines.Length;
    var colCount = stateLines.First().Length;

    for (int row = 0; row < rowCount; row++)
    {
        var newLine = stateLines[row];
        for (int col = 0; col < colCount; col++)
        {
            if (stateLines[row][col] == '>')
            {
                var next = (col + 1) % colCount;
                if (stateLines[row][next] == '.')
                {
                    if (next == 0)
                    {
                        newLine = '>' + newLine[1..^1] + '.';
                    }
                    else
                    {
                        newLine = newLine[..col] + ".>" + newLine[(next + 1)..];
                    }
                }
            }
        }
        yield return newLine;
    }
}

IEnumerable<string> simulateDown(List<string> stateLines)
{
    var rowCount = stateLines.Count();
    var colCount = stateLines.First().Length;

    var ret = stateLines.Select(s => s).ToList();
    for (int col = 0; col < colCount; col++)
    {
        for (int row = 0; row < rowCount; row++)
        {
            if (stateLines[row][col] == 'v')
            {
                var next = (row + 1) % rowCount;
                if (stateLines[next][col] == '.')
                {
                    var s0 = ret[row];
                    var s1 = ret[next];
                    ret[row] = s0[..col] + '.' + s0[(col + 1)..];
                    ret[next] = s1[..col] + 'v' + s1[(col + 1)..];
                    var c0 = ret[row].Count();
                    var c1 = ret[next].Count();
                }
            }
        }
    }
    return ret;
}
